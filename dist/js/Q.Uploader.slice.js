//devin87@qq.com
//build:2018/12/12 10:36:51
!function(e,n){"use strict";var h=Q.Uploader;if(h.support.html5){var o=e.File?File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice:void 0;h.extend({_upload_slice:function(s){var c,p=this,e=s.blob||s.file,d=e.size,n=p.chunkSize,u=s.sliceStart||0,f=p.sliceRetryCount,v=function(e,i,n){var t=new XMLHttpRequest,o=s.url,r=c==d;s.xhr=t,o+=(-1==o.indexOf("?")?"?":"&")+"action=upload&hash="+(s.hash||s.name)+"&ok="+(r?"1":"0"),t.upload.addEventListener("progress",function(e){p.progress(s,d,u+e.loaded)},!1);var a=function(){if(n=+n||0,f<++n)return p.complete(s,h.ERROR);v(e,i,n)};t.addEventListener("load",function(e){var n=e.target.responseText;return r?p.complete(s,h.COMPLETE,n):1==n||'"1"'==n?i():void a()},!1),t.addEventListener("error",a,!1);var l=new FormData;p._process_params(s,function(e,n){l.append(e,n)}),l.append("fileName",s.name),-1!=s.size&&l.append("fileSize",s.size),l.append(p.upName,e,s.name),l.append("sliceCount",s.sliceCount),l.append("sliceIndex",s.sliceIndex),t.open("POST",o),p._process_xhr_headers(t),r?p.fire("send",s,function(e){if(!1===e)return p.complete(s,h.SKIP);t.send(l)}):t.send(l)};s.sliceCount=Math.ceil(d/n);var i=function(){d<=u||(d<(c=u+n)&&(c=d),s.sliceStart=u,s.sliceEnd=c,s.sliceIndex=Math.ceil(c/n),s.sliceBlob=o.call(e,u,c),p.fire("sliceUpload",s,function(e){if(!1===e)return t();v(s.sliceBlob,t)}))},t=function(){u=c,i()};i(),p._afterSend(s)}})}}(window);